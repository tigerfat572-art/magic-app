<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Calculator</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <style>
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            padding-bottom: env(safe-area-inset-bottom);
            box-sizing: border-box;
        }

        /* --- 设置页面 --- */
        #setup-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000000; z-index: 2000; display: flex; flex-direction: column;
            align-items: center; color: white;
            padding-top: calc(env(safe-area-inset-top) + 60px);
            padding-left: 16px; padding-right: 16px; box-sizing: border-box; overflow-y: auto;
        }

        .setup-header { width: 100%; max-width: 350px; margin-bottom: 30px; padding-left: 10px; }
        .setup-title { font-size: 34px; font-weight: 700; margin-bottom: 5px; letter-spacing: 0.5px; }
        .setup-subtitle { font-size: 15px; color: #8e8e93; }

        .section-group {
            width: 100%; max-width: 350px; background: #1c1c1e; border-radius: 12px;
            overflow: hidden; margin-bottom: 24px;
        }

        .group-title {
            width: 100%; max-width: 350px; padding: 0 0 8px 10px; 
            font-size: 13px; color: #8e8e93; text-transform: uppercase;
        }

        .list-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px; background: #1c1c1e; border-bottom: 1px solid #38383a;
            transition: background 0.2s; cursor: pointer;
        }
        .list-item:last-child { border-bottom: none; }
        .list-item:active { background: #2c2c2e; }

        .item-label { font-size: 17px; font-weight: 400; }
        .check-icon { color: #ff9f0a; font-weight: bold; margin-left: 10px; display: none; }
        .list-item.selected .check-icon { display: block; }
        .list-item.selected .item-label { color: #ff9f0a; }

        .input-row { padding: 0; border-bottom: 1px solid #38383a; }
        .input-row:last-child { border-bottom: none; }
        .magic-input {
            width: 100%; padding: 16px; background: transparent; border: none;
            color: white; font-size: 17px; outline: none;
        }
        .magic-input::placeholder { color: #636366; }
        
        .file-row {
            position: relative; padding: 16px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #38383a;
        }
        .file-row:last-child { border-bottom: none; }

        .file-label { color: #0a84ff; font-size: 17px; }
        .file-status { font-size: 14px; color: #636366; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        input[type="file"] {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;
        }

        .switch { position: relative; display: inline-block; width: 51px; height: 31px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #39393d; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 27px; width: 27px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 3px 8px rgba(0,0,0,0.15); }
        input:checked + .slider { background-color: #30d158; }
        input:checked + .slider:before { transform: translateX(20px); }

        .hidden-section { display: none; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* 按钮组样式 */
        .btn-container {
            width: 100%; max-width: 350px;
            display: flex; gap: 10px; margin-bottom: 60px; margin-top: 10px;
        }
        
        .action-btn {
            flex: 1; border: none; padding: 16px; border-radius: 12px; font-size: 17px;
            font-weight: 600; cursor: pointer; text-align: center;
        }
        .action-btn:active { opacity: 0.8; }

        .save-btn { background-color: #3a3a3c; color: #0a84ff; }
        .start-btn { background-color: #ff9f0a; color: white; }

        /* --- 计算器主体 --- */
        .calculator-wrapper { display: none; height: 100%; width: 100%; flex-direction: column; justify-content: flex-end; }
        .calculator { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; max-width: 500px; margin: 0 auto; position: relative; }
        
        .display-container { flex-grow: 1; display: flex; justify-content: flex-end; align-items: flex-end; padding: 20px 24px 15px 24px; position: relative; overflow: hidden;}
        
        #display { 
            color: white; font-size: 90px; font-weight: 300; line-height: 1; 
            text-align: right; 
            white-space: pre-wrap; 
            word-break: break-all;
            outline: none; min-width: 50px; width: 100%;
            caret-color: #ff9f0a; 
            display: flex; justify-content: flex-end; align-items: flex-end;
        }
        
        #display img {
            max-height: 350px;
            max-width: 100%;
            object-fit: contain;
            border-radius: 8px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #display[contenteditable="true"] { cursor: text; }

        /* 遥控器状态显示 */
        #remote-indicator {
            position: absolute; top: calc(env(safe-area-inset-top) + 10px); left: 20px;
            font-size: 12px; color: #30d158; opacity: 0; transition: opacity 0.5s;
            pointer-events: none;
        }

        .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; padding: 0 14px 14px 14px; position: relative; }
        
        /* 隐形按钮 */
        #ui-layer-mask { 
            position: absolute; top: -80px; right: 0; width: 25%; height: 100px; 
            background: transparent !important; z-index: 999;
            -webkit-tap-highlight-color: transparent; outline: none;
        }
        
        #status-dot { position: absolute; bottom: 15px; left: 15px; width: 4px; height: 4px; background: rgba(255,255,255,0.6); border-radius: 50%; opacity: 0; transition: opacity 0.2s; pointer-events: none; z-index: 300; }
        
        .btn { 
            aspect-ratio: 1; width: 100%; border-radius: 50%; border: none; 
            font-size: 34px; font-weight: 400; cursor: pointer; 
            display: flex; justify-content: center; align-items: center; 
            transition: background-color 0.2s ease-out; 
            outline: none; -webkit-tap-highlight-color: transparent; 
        }
        
        .btn-num { background-color: #333333; color: white; }
        .btn-fn { background-color: #a5a5a5; color: black; }
        .btn-op { background-color: #ff9f0a; color: white; font-size: 40px; padding-bottom: 4px; }
        
        /* 激活状态样式 */
        .btn.active-state { transition: none; }
        
        .btn-num:active, .btn-num.active-state { background-color: #737373 !important; }
        .btn-fn:active, .btn-fn.active-state { background-color: #d9d9d9 !important; }
        .btn-op:active, .btn-op.active-state { background-color: #fbc78d !important; color: #ff9f0a !important; }
        
        .btn-zero { grid-column: span 2; aspect-ratio: auto; height: 100%; border-radius: 100px; justify-content: flex-start; padding-left: 34px; }

    </style>
</head>
<body ontouchstart="" oncontextmenu="return false;">

    <!-- 设置页面 -->
    <div id="setup-screen">
        <div class="setup-header">
            <div class="setup-title">Magic Panghu</div>
            <div class="setup-subtitle">魔术设置</div>
        </div>
        
        <!-- 模式选择 -->
        <div class="section-group">
            <div class="list-item selected" id="mode-time" onclick="selectMode('time')">
                <span class="item-label">当前时间 (MMDDHHmm)</span>
                <span class="check-icon">✓</span>
            </div>
            <div class="list-item" id="mode-fixed" onclick="selectMode('fixed')">
                <span class="item-label">固定数字</span>
                <span class="check-icon">✓</span>
            </div>
            <div class="input-row hidden-section" id="fixed-input-row">
                <input type="number" id="fixed-number-input" class="magic-input" placeholder="在此输入预设结果...">
            </div>
        </div>

        <!-- 除0设置 1 -->
        <div class="group-title">第一次 除以 0 (铺垫)</div>
        <div class="section-group">
            <div class="input-row">
                <input type="text" id="div-zero-1-text" class="magic-input" placeholder="显示文本 (默认: 错误)">
            </div>
            <div class="file-row">
                <span class="file-label">显示图片 (点击选择)</span>
                <span id="img-status-1" class="file-status">未选择</span>
                <input type="file" accept="image/*" onchange="handleImageSelect(this, 0)">
            </div>
        </div>

        <!-- 除0设置 2 -->
        <div class="group-title">第二次 除以 0 (预言)</div>
        <div class="section-group">
            <div class="input-row">
                <input type="text" id="div-zero-2-text" class="magic-input" placeholder="显示文本 (默认: 错误)">
            </div>
            <div class="file-row">
                <span class="file-label">显示图片 (点击选择)</span>
                <span id="img-status-2" class="file-status">未选择</span>
                <input type="file" accept="image/*" onchange="handleImageSelect(this, 1)">
            </div>
        </div>

        <!-- 远程设置 -->
        <div class="section-group">
            <div class="list-item">
                <span class="item-label">远程助手模式</span>
                <label class="switch">
                    <input type="checkbox" id="remote-toggle" onchange="toggleRemoteSettings()">
                    <span class="slider"></span>
                </label>
            </div>
            <div id="remote-settings-block" class="hidden-section">
                <div class="list-item selected" id="role-calc" onclick="selectRole('calc')">
                    <span class="item-label">本机作为: 魔术计算器</span>
                    <span class="check-icon">✓</span>
                </div>
                <div class="list-item" id="role-remote" onclick="selectRole('remote')">
                    <span class="item-label">本机作为: 遥控助手</span>
                    <span class="check-icon">✓</span>
                </div>
                <div class="input-row">
                    <input type="text" id="room-id" class="magic-input" placeholder="房间号 (例如: 888)" value="888">
                </div>
            </div>
        </div>

        <!-- 底部按钮组 -->
        <div class="btn-container">
            <button class="action-btn save-btn" onclick="saveSettings()">保存配置</button>
            <button class="action-btn start-btn" onclick="startApp()">进入系统</button>
        </div>
    </div>

    <!-- 计算器主体 -->
    <div class="calculator-wrapper" id="calc-app">
        <div class="calculator">
            <div id="remote-indicator">助手模式: 未连接</div>
            <div id="status-dot"></div>
            
            <div class="display-container">
                <div id="display">0</div>
            </div>
            
            <div class="buttons">
                <div id="ui-layer-mask"></div>
                
                <button id="btn-AC" class="btn btn-fn" 
                        ontouchstart="startAcLongPress(event)" 
                        ontouchend="endAcLongPress(event)" 
                        onmousedown="startAcLongPress(event)" 
                        onmouseup="endAcLongPress(event)"
                        onmouseleave="cancelAcLongPress()">AC</button>
                
                <button id="btn-PLUS_MINUS" class="btn btn-fn" onclick="onBtnClick('+/-')">+/-</button>
                <button id="btn-PERCENT" class="btn btn-fn" onclick="onBtnClick('%')">%</button>
                <button id="btn-DIV" class="btn btn-op" onclick="onBtnClick('/')">÷</button>
                <button id="btn-7" class="btn btn-num" onclick="onBtnClick('7')">7</button>
                <button id="btn-8" class="btn btn-num" onclick="onBtnClick('8')">8</button>
                <button id="btn-9" class="btn btn-num" onclick="onBtnClick('9')">9</button>
                <button id="btn-MUL" class="btn btn-op" onclick="onBtnClick('*')">×</button>
                <button id="btn-4" class="btn btn-num" onclick="onBtnClick('4')">4</button>
                <button id="btn-5" class="btn btn-num" onclick="onBtnClick('5')">5</button>
                <button id="btn-6" class="btn btn-num" onclick="onBtnClick('6')">6</button>
                <button id="btn-SUB" class="btn btn-op" onclick="onBtnClick('-')">-</button>
                <button id="btn-1" class="btn btn-num" onclick="onBtnClick('1')">1</button>
                <button id="btn-2" class="btn btn-num" onclick="onBtnClick('2')">2</button>
                <button id="btn-3" class="btn btn-num" onclick="onBtnClick('3')">3</button>
                <button id="btn-ADD" class="btn btn-op" onclick="onBtnClick('+')">+</button>
                <button id="btn-0" class="btn btn-num btn-zero" onclick="onBtnClick('0')">0</button>
                <button id="btn-DOT" class="btn btn-num" onclick="onBtnClick('.')">.</button>
                <button id="btn-EQUAL" class="btn btn-op" onclick="onBtnClick('=')">=</button>
            </div>
        </div>
    </div>

    <script>
      const _0x4b931a=_0x4028;(function(_0x52d1fb,_0x32a20e){const _0x229c92=_0x4028,_0x2edd4c=_0x52d1fb();while(!![]){try{const _0x5694ff=-parseInt(_0x229c92(0x107))/0x1+-parseInt(_0x229c92(0x111))/0x2*(-parseInt(_0x229c92(0xf9))/0x3)+parseInt(_0x229c92(0xe2))/0x4*(parseInt(_0x229c92(0x12e))/0x5)+-parseInt(_0x229c92(0x104))/0x6*(-parseInt(_0x229c92(0x119))/0x7)+parseInt(_0x229c92(0xe0))/0x8+-parseInt(_0x229c92(0x172))/0x9+-parseInt(_0x229c92(0x127))/0xa;if(_0x5694ff===_0x32a20e)break;else _0x2edd4c['push'](_0x2edd4c['shift']());}catch(_0x12d99a){_0x2edd4c['push'](_0x2edd4c['shift']());}}}(_0x1693,0x1cfcc));const _0x525039=(function(){let _0x858284=!![];return function(_0xdff7d7,_0x2fe0e1){const _0x546b48=_0x858284?function(){if(_0x2fe0e1){const _0x502f38=_0x2fe0e1['apply'](_0xdff7d7,arguments);return _0x2fe0e1=null,_0x502f38;}}:function(){};return _0x858284=![],_0x546b48;};}()),_0x4b6799=_0x525039(this,function(){const _0x16a1a8=_0x4028;return _0x4b6799['toString']()[_0x16a1a8(0x138)](_0x16a1a8(0xf8))[_0x16a1a8(0x12b)]()['constructor'](_0x4b6799)['search'](_0x16a1a8(0xf8));});_0x4b6799();const _0x251ea0=(function(){let _0xe4207d=!![];return function(_0x2acaa6,_0x4a546d){const _0x28cc49=_0xe4207d?function(){const _0x119543=_0x4028;if(_0x4a546d){const _0x5b3b85=_0x4a546d[_0x119543(0xe9)](_0x2acaa6,arguments);return _0x4a546d=null,_0x5b3b85;}}:function(){};return _0xe4207d=![],_0x28cc49;};}());(function(){_0x251ea0(this,function(){const _0x5558cf=_0x4028,_0x52cecb=new RegExp(_0x5558cf(0x11e)),_0x18ebf8=new RegExp(_0x5558cf(0x13d),'i'),_0x5826ee=_0x16e59d(_0x5558cf(0x155));!_0x52cecb[_0x5558cf(0x16a)](_0x5826ee+'chain')||!_0x18ebf8['test'](_0x5826ee+_0x5558cf(0xfb))?_0x5826ee('0'):_0x16e59d();})();}()),document[_0x4b931a(0x15c)](_0x4b931a(0x166),_0x291c6d=>_0x291c6d['preventDefault']()),document[_0x4b931a(0x126)]=function(_0x20acd2){const _0x153630=_0x4b931a;if(_0x20acd2['keyCode']==0x7b)return![];if(_0x20acd2[_0x153630(0xe4)]&&_0x20acd2[_0x153630(0x12f)]&&_0x20acd2[_0x153630(0x10d)]=='I'[_0x153630(0x14d)](0x0))return![];if(_0x20acd2[_0x153630(0xe4)]&&_0x20acd2['shiftKey']&&_0x20acd2['keyCode']=='C'[_0x153630(0x14d)](0x0))return![];if(_0x20acd2['ctrlKey']&&_0x20acd2['shiftKey']&&_0x20acd2[_0x153630(0x10d)]=='J'[_0x153630(0x14d)](0x0))return![];if(_0x20acd2['ctrlKey']&&_0x20acd2['keyCode']=='U'[_0x153630(0x14d)](0x0))return![];},setInterval(function(){debugger;},0x64);let appRole=_0x4b931a(0x169),magicMode=_0x4b931a(0x167),fixedTargetValue=0x0,divZeroConfig=[{'text':'错误','img':null},{'text':'错误','img':null}],divZeroCounter=0x0,mqttClient=null,roomId='888',acTimer=null,isRemoteEnabled=![],isComposing=![];const mqttBroker=_0x4b931a(0xf0),mqttOptions={'clean':!![],'connectTimeout':0x1388,'reconnectPeriod':0x3e8,'keepalive':0x3c},displayElement=document[_0x4b931a(0xeb)](_0x4b931a(0x11d)),keyMap={'AC':_0x4b931a(0x145),'+/-':_0x4b931a(0x149),'%':'btn-PERCENT','/':'btn-DIV','÷':_0x4b931a(0xe3),'7':_0x4b931a(0xf5),'8':_0x4b931a(0xe6),'9':'btn-9','*':'btn-MUL','×':_0x4b931a(0x164),'4':_0x4b931a(0x130),'5':'btn-5','6':'btn-6','-':'btn-SUB','1':_0x4b931a(0xe5),'2':_0x4b931a(0x120),'3':_0x4b931a(0xff),'+':_0x4b931a(0x123),'0':_0x4b931a(0x17c),'.':_0x4b931a(0x11a),'=':_0x4b931a(0x17b)};function throttle(_0xc127ae,_0x2d43f9){let _0x170903,_0x25bf07;return function(){const _0x114255=_0x4028,_0x2eb07c=this,_0x3b27dc=arguments;!_0x25bf07?(_0xc127ae[_0x114255(0xe9)](_0x2eb07c,_0x3b27dc),_0x25bf07=Date[_0x114255(0x121)]()):(clearTimeout(_0x170903),_0x170903=setTimeout(function(){const _0x2dd564=_0x114255;Date['now']()-_0x25bf07>=_0x2d43f9&&(_0xc127ae[_0x2dd564(0xe9)](_0x2eb07c,_0x3b27dc),_0x25bf07=Date[_0x2dd564(0x121)]());},_0x2d43f9-(Date[_0x114255(0x121)]()-_0x25bf07)));};}function _0x4028(_0x2420a3,_0x3c21ed){const _0x527223=_0x1693();return _0x4028=function(_0x16e59d,_0x251ea0){_0x16e59d=_0x16e59d-0xdf;let _0x568bfd=_0x527223[_0x16e59d];return _0x568bfd;},_0x4028(_0x2420a3,_0x3c21ed);}function saveSettings(){const _0x545741=_0x4b931a;divZeroConfig[0x0][_0x545741(0x15b)]=document[_0x545741(0xeb)](_0x545741(0xea))[_0x545741(0x159)],divZeroConfig[0x1]['text']=document[_0x545741(0xeb)](_0x545741(0x11c))[_0x545741(0x159)];const _0x12db81={'mode':magicMode,'fixedValue':document['getElementById'](_0x545741(0xee))[_0x545741(0x159)],'divZeroConfig':divZeroConfig,'isRemote':document[_0x545741(0xeb)](_0x545741(0x14a))[_0x545741(0x100)],'role':appRole,'roomId':document['getElementById'](_0x545741(0x176))['value']};try{localStorage[_0x545741(0xfa)](_0x545741(0x168),JSON['stringify'](_0x12db81)),alert('配置已保存！下次打开自动加载。');}catch(_0x166a76){alert(_0x545741(0x103)),console[_0x545741(0x142)](_0x166a76);}}function loadSettings(){const _0x1a89b7=_0x4b931a,_0x1bdffd=localStorage[_0x1a89b7(0x112)](_0x1a89b7(0x168));if(!_0x1bdffd)return;try{const _0x315838=JSON[_0x1a89b7(0x152)](_0x1bdffd);if(_0x315838[_0x1a89b7(0x116)])selectMode(_0x315838['mode']);if(_0x315838[_0x1a89b7(0x15d)])document[_0x1a89b7(0xeb)]('fixed-number-input')['value']=_0x315838[_0x1a89b7(0x15d)];if(_0x315838['divZeroConfig']){divZeroConfig=_0x315838['divZeroConfig'];if(divZeroConfig[0x0][_0x1a89b7(0x15b)])document['getElementById'](_0x1a89b7(0xea))['value']=divZeroConfig[0x0][_0x1a89b7(0x15b)];if(divZeroConfig[0x1][_0x1a89b7(0x15b)])document[_0x1a89b7(0xeb)](_0x1a89b7(0x11c))[_0x1a89b7(0x159)]=divZeroConfig[0x1][_0x1a89b7(0x15b)];const _0x1cfb52=document[_0x1a89b7(0xeb)](_0x1a89b7(0x161));divZeroConfig[0x0][_0x1a89b7(0x13c)]&&(_0x1cfb52['innerText']=_0x1a89b7(0x14c),_0x1cfb52[_0x1a89b7(0x146)][_0x1a89b7(0x113)]=_0x1a89b7(0x141));const _0x3adf14=document['getElementById']('img-status-2');divZeroConfig[0x1][_0x1a89b7(0x13c)]&&(_0x3adf14[_0x1a89b7(0x109)]='已加载存档图片',_0x3adf14[_0x1a89b7(0x146)][_0x1a89b7(0x113)]=_0x1a89b7(0x141));}_0x315838[_0x1a89b7(0x134)]&&(document[_0x1a89b7(0xeb)](_0x1a89b7(0x14a))['checked']=!![],toggleRemoteSettings());if(_0x315838[_0x1a89b7(0x118)])selectRole(_0x315838[_0x1a89b7(0x118)]);if(_0x315838[_0x1a89b7(0x11b)])document[_0x1a89b7(0xeb)](_0x1a89b7(0x176))['value']=_0x315838[_0x1a89b7(0x11b)];}catch(_0x4746c9){console['error']('读取存档失败',_0x4746c9);}}function selectMode(_0x94468){const _0x4bf738=_0x4b931a;magicMode=_0x94468,document[_0x4bf738(0xeb)]('mode-time')['classList'][_0x4bf738(0x124)](_0x4bf738(0x170)),document['getElementById'](_0x4bf738(0x10f))[_0x4bf738(0x150)][_0x4bf738(0x124)](_0x4bf738(0x170));const _0x8d6317=document[_0x4bf738(0xeb)](_0x4bf738(0x139));_0x94468===_0x4bf738(0x167)?(document[_0x4bf738(0xeb)](_0x4bf738(0x17d))[_0x4bf738(0x150)][_0x4bf738(0xf1)]('selected'),_0x8d6317[_0x4bf738(0x146)][_0x4bf738(0x11d)]=_0x4bf738(0x15a)):(document[_0x4bf738(0xeb)](_0x4bf738(0x10f))['classList'][_0x4bf738(0xf1)](_0x4bf738(0x170)),_0x8d6317['style']['display']=_0x4bf738(0x114));}function toggleRemoteSettings(){const _0x3da891=_0x4b931a,_0x4ca6bc=document[_0x3da891(0xeb)](_0x3da891(0x14a)),_0x1bc426=document[_0x3da891(0xeb)]('remote-settings-block');isRemoteEnabled=_0x4ca6bc[_0x3da891(0x100)],isRemoteEnabled?_0x1bc426[_0x3da891(0x146)][_0x3da891(0x11d)]=_0x3da891(0x114):(_0x1bc426[_0x3da891(0x146)][_0x3da891(0x11d)]=_0x3da891(0x15a),selectRole(_0x3da891(0x169)));}function _0x1693(){const _0x55f3f5=['1492GXMoZb','btn-DIV','ctrlKey','btn-1','btn-8','fixed','90px','apply','div-zero-1-text','getElementById','gger','debu','fixed-number-input','readAsDataURL','wss://broker.emqx.io:8084/mqtt','add','40px','connect','DIV','btn-7','getHours','toFixed','(((.+)+)+)+$','111951zYIzRV','setItem','input','true','target','status-dot','btn-3','checked','70px','constructor','保存失败，可能是图片太大。请尝试压缩图片。','54VdsIri','click','object','13208SnadEo','<img\x20src=\x22','innerText','MUL','role-remote','getDate','keyCode','stopPropagation','mode-fixed','connected','6dUzopV','getItem','color','block','+/-','mode','cancelable','role','36967EJbfSL','btn-DOT','roomId','div-zero-2-text','display','function\x20*\x5c(\x20*\x5c)','role-calc','btn-2','now','reconnect','btn-ADD','remove','message','onkeydown','1341930sDltam','fontSize','result','remote-indicator','toString','querySelector','remote','1315nVgOBV','shiftKey','btn-4','reload','vibrate','files','isRemote','compositionstart','magic-calc/','#ff9f0a','search','fixed-input-row','calc-app','string','img','\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','action','getMinutes','padStart','#30d158','error','call','888','btn-AC','style','false','while\x20(true)\x20{}','btn-PLUS_MINUS','remote-toggle','img-status-2','已加载存档图片','charCodeAt','50px','ADD','classList','opacity','parse','读取中...','setup-screen','init','compositionend','preventDefault','active-state','value','none','text','addEventListener','fixedValue','innerHTML','SUB','substring','img-status-1','isInteger','EQUAL','btn-MUL','请输入固定数字','contextmenu','time','magicCalcSettings','calc','test','getMonth','onload','CMD:','end','isDivZero','selected','length','743553IvtHxU','重连中...','counter','已选择新图片','room-id','ui-layer-mask','contentEditable','TXT:','flex','btn-EQUAL','btn-0','mode-time','startsWith','729368ifbTgh','\x22\x20/>'];_0x1693=function(){return _0x55f3f5;};return _0x1693();}function selectRole(_0x5ebd58){const _0x3fe533=_0x4b931a;appRole=_0x5ebd58,document['getElementById'](_0x3fe533(0x11f))['classList'][_0x3fe533(0x124)](_0x3fe533(0x170)),document[_0x3fe533(0xeb)](_0x3fe533(0x10b))[_0x3fe533(0x150)][_0x3fe533(0x124)](_0x3fe533(0x170)),_0x5ebd58===_0x3fe533(0x169)?document[_0x3fe533(0xeb)](_0x3fe533(0x11f))['classList'][_0x3fe533(0xf1)](_0x3fe533(0x170)):document[_0x3fe533(0xeb)]('role-remote')[_0x3fe533(0x150)]['add'](_0x3fe533(0x170));}function handleImageSelect(_0x3ded89,_0x3c1d1c){const _0x312b55=_0x4b931a,_0x2d668c=_0x3c1d1c===0x0?_0x312b55(0x161):_0x312b55(0x14b),_0x157b9f=document[_0x312b55(0xeb)](_0x2d668c);if(_0x3ded89[_0x312b55(0x133)]&&_0x3ded89['files'][0x0]){const _0x741510=_0x3ded89[_0x312b55(0x133)][0x0];_0x157b9f[_0x312b55(0x109)]=_0x312b55(0x153);const _0x53fa7b=new FileReader();_0x53fa7b[_0x312b55(0x16c)]=function(_0x4981c4){const _0x20f662=_0x312b55;divZeroConfig[_0x3c1d1c][_0x20f662(0x13c)]=_0x4981c4[_0x20f662(0xfd)][_0x20f662(0x129)],_0x157b9f[_0x20f662(0x109)]=_0x20f662(0x175),_0x157b9f[_0x20f662(0x146)]['color']=_0x20f662(0x141);},_0x53fa7b[_0x312b55(0xef)](_0x741510);}}function startApp(){const _0xd6ab1b=_0x4b931a;roomId=document[_0xd6ab1b(0xeb)](_0xd6ab1b(0x176))['value']||_0xd6ab1b(0x144);if(magicMode===_0xd6ab1b(0xe7)){const _0x1813ed=document[_0xd6ab1b(0xeb)]('fixed-number-input')[_0xd6ab1b(0x159)];if(!_0x1813ed&&appRole==='calc'){alert(_0xd6ab1b(0x165));return;}fixedTargetValue=parseFloat(_0x1813ed);}const _0x35456e=document['getElementById'](_0xd6ab1b(0xea))[_0xd6ab1b(0x159)],_0x420b8a=document[_0xd6ab1b(0xeb)]('div-zero-2-text')[_0xd6ab1b(0x159)];if(_0x35456e)divZeroConfig[0x0]['text']=_0x35456e;if(_0x420b8a)divZeroConfig[0x1][_0xd6ab1b(0x15b)]=_0x420b8a;document['getElementById']('setup-screen')['style']['display']=_0xd6ab1b(0x15a),document['getElementById'](_0xd6ab1b(0x13a))[_0xd6ab1b(0x146)][_0xd6ab1b(0x11d)]='flex',appRole===_0xd6ab1b(0x169)?(document[_0xd6ab1b(0xeb)](_0xd6ab1b(0x177))[_0xd6ab1b(0x146)]['display']=_0xd6ab1b(0x114),displayElement['contentEditable']=_0xd6ab1b(0x147),isRemoteEnabled&&initMqttReceiver()):(document['getElementById']('ui-layer-mask')[_0xd6ab1b(0x146)][_0xd6ab1b(0x11d)]=_0xd6ab1b(0x15a),document[_0xd6ab1b(0xeb)](_0xd6ab1b(0x12a))[_0xd6ab1b(0x146)]['opacity']='1',displayElement[_0xd6ab1b(0x178)]=_0xd6ab1b(0xfc),displayElement['addEventListener'](_0xd6ab1b(0x135),()=>{isComposing=!![];}),displayElement[_0xd6ab1b(0x15c)](_0xd6ab1b(0x156),_0x21f04f=>{isComposing=![],setTimeout(()=>{resizeFont(),sendThrottledSyncContent();},0x32);}),displayElement['addEventListener'](_0xd6ab1b(0xfb),_0x361881=>{if(isComposing)return;resizeFont(),sendThrottledSyncContent();}),initMqttSender());}function onBtnClick(_0x155119){const _0x57f65f=_0x4b931a;appRole===_0x57f65f(0x12d)?handleRemoteInput(_0x155119):handleInput(_0x155119);}function handleRemoteInput(_0x335046){const _0x1a4d26=_0x4b931a,_0x943162=['0','1','2','3','4','5','6','7','8','9','.','+','-','*','×','/','÷','=','AC',_0x1a4d26(0x115),'%'];let _0x57b52c=_0x335046;if(_0x335046===_0x1a4d26(0x10a))_0x57b52c='*';if(_0x335046===_0x1a4d26(0xf4))_0x57b52c='/';if(_0x335046===_0x1a4d26(0x14f))_0x57b52c='+';if(_0x335046===_0x1a4d26(0x15f))_0x57b52c='-';if(_0x335046===_0x1a4d26(0x163))_0x57b52c='=';if(navigator[_0x1a4d26(0x132)])navigator[_0x1a4d26(0x132)](0x1e);if(_0x943162['includes'](_0x57b52c)){if(_0x57b52c==='AC')displayElement[_0x1a4d26(0x15e)]='0';else{const _0x14ab58=['+','-','*','×','/','÷','=','AC',_0x1a4d26(0x115),'%'];if(_0x14ab58['includes'](_0x57b52c))displayElement['innerHTML']='';else{let _0xe4b75=displayElement[_0x1a4d26(0x109)];const _0x1fdeb7=displayElement['querySelector']('img')!==null;_0xe4b75==='0'||_0xe4b75===''||_0x1fdeb7?displayElement[_0x1a4d26(0x109)]=_0x57b52c:displayElement[_0x1a4d26(0x109)]+=_0x57b52c;}}sendCmdContent(_0x57b52c),resizeFont();return;}let _0x363b4f=displayElement['innerText'];const _0x26d3a2=displayElement['querySelector'](_0x1a4d26(0x13c))!==null;_0x363b4f==='0'||_0x363b4f===''||_0x26d3a2?displayElement[_0x1a4d26(0x109)]=_0x57b52c:displayElement[_0x1a4d26(0x109)]+=_0x57b52c,resizeFont(),sendThrottledSyncContent();}const sendThrottledSyncContent=throttle(function(){const _0x34c0a2=_0x4b931a;if(isComposing)return;if(mqttClient&&mqttClient[_0x34c0a2(0x110)]){const _0x42927b=displayElement[_0x34c0a2(0x109)];mqttClient['publish'](_0x34c0a2(0x136)+roomId,_0x34c0a2(0x179)+_0x42927b,{'qos':0x0,'retain':![]});}},0x50);function sendCmdContent(_0x1b59d8){const _0x48c2a6=_0x4b931a;mqttClient&&mqttClient[_0x48c2a6(0x110)]&&mqttClient['publish']('magic-calc/'+roomId,_0x48c2a6(0x16d)+_0x1b59d8,{'qos':0x0,'retain':![]});}function simulateRemotePress(_0x452d70){const _0x398e1e=_0x4b931a,_0x7c489d=keyMap[_0x452d70];if(_0x7c489d){const _0x52e9ed=document[_0x398e1e(0xeb)](_0x7c489d);_0x52e9ed&&(_0x52e9ed[_0x398e1e(0x150)][_0x398e1e(0xf1)](_0x398e1e(0x158)),setTimeout(()=>{const _0x3a38b6=_0x398e1e;_0x52e9ed['classList'][_0x3a38b6(0x124)](_0x3a38b6(0x158));},0x258));}}function initMqttReceiver(){const _0x22c9f5=_0x4b931a;mqttClient=mqtt[_0x22c9f5(0xf3)](mqttBroker,mqttOptions),mqttClient['on'](_0x22c9f5(0xf3),()=>{const _0x4b022c=_0x22c9f5;mqttClient['subscribe'](_0x4b022c(0x136)+roomId,{'qos':0x0}),statusDot['style']['opacity']='1',setTimeout(()=>statusDot[_0x4b022c(0x146)][_0x4b022c(0x151)]='0',0x320);}),mqttClient['on'](_0x22c9f5(0x125),(_0x56f20a,_0x2c016c)=>{const _0x4d68e1=_0x22c9f5,_0x1f8ffa=_0x2c016c[_0x4d68e1(0x12b)]();if(_0x1f8ffa[_0x4d68e1(0xdf)](_0x4d68e1(0x179))){const _0x145f18=_0x1f8ffa['substring'](0x4);_0x145f18==='0'?(displayElement['innerHTML']='0',currentDisplay='0'):displayElement[_0x4d68e1(0x109)]=_0x145f18;const _0x3d58d0=parseFloat(_0x145f18);if(!isNaN(_0x3d58d0))currentDisplay=String(_0x3d58d0);else currentDisplay='0';resizeFont();}else{if(_0x1f8ffa[_0x4d68e1(0xdf)](_0x4d68e1(0x16d))){const _0x5eb73a=_0x1f8ffa[_0x4d68e1(0x160)](0x4);simulateRemotePress(_0x5eb73a),handleInput(_0x5eb73a);}else handleInput(_0x1f8ffa);}});}function initMqttSender(){const _0x36c836=_0x4b931a;mqttClient=mqtt[_0x36c836(0xf3)](mqttBroker,mqttOptions);const _0x3bc4df=document[_0x36c836(0xeb)](_0x36c836(0x12a));mqttClient['on'](_0x36c836(0xf3),()=>{const _0x5242a5=_0x36c836;_0x3bc4df[_0x5242a5(0x109)]='助手模式:\x20已连接\x20('+roomId+')',_0x3bc4df[_0x5242a5(0x146)][_0x5242a5(0x113)]=_0x5242a5(0x141);if(navigator['vibrate'])navigator[_0x5242a5(0x132)](0xc8);}),mqttClient['on'](_0x36c836(0x122),()=>{const _0x54e7d3=_0x36c836;_0x3bc4df[_0x54e7d3(0x109)]=_0x54e7d3(0x173),_0x3bc4df[_0x54e7d3(0x146)][_0x54e7d3(0x113)]=_0x54e7d3(0x137);});}function startAcLongPress(_0x518184){if(acTimer)clearTimeout(acTimer);acTimer=setTimeout(()=>{const _0x500af5=_0x4028;if(navigator[_0x500af5(0x132)])navigator[_0x500af5(0x132)](0x64);if(mqttClient)mqttClient[_0x500af5(0x16e)]();location[_0x500af5(0x131)]();},0x5dc);}function endAcLongPress(_0x57d882){const _0x3d8c13=_0x4b931a;if(acTimer){clearTimeout(acTimer),acTimer=null;if(_0x57d882&&_0x57d882[_0x3d8c13(0x117)])_0x57d882[_0x3d8c13(0x157)]();onBtnClick('AC');}}function cancelAcLongPress(){if(acTimer)clearTimeout(acTimer);}let currentDisplay='0',previousValue=null,currentOperator=null,waitingForOperand=![],_isReady=![],_isFrozen=![],_isPostReveal=![];const hiddenBtn=document[_0x4b931a(0xeb)](_0x4b931a(0x177)),statusDot=document[_0x4b931a(0xeb)](_0x4b931a(0xfe));hiddenBtn[_0x4b931a(0x15c)](_0x4b931a(0x105),_0x573d4f=>{const _0x5e190f=_0x4b931a;_0x573d4f[_0x5e190f(0x10e)](),_0x573d4f[_0x5e190f(0x157)]();if(appRole===_0x5e190f(0x12d))return;!_isFrozen&&!_isPostReveal&&(_isReady=!![],statusDot['style'][_0x5e190f(0x151)]='1');});function handleInput(_0x67bb3c){const _0x218411=_0x4b931a;if(document[_0x218411(0xeb)](_0x218411(0x154))[_0x218411(0x146)]['display']===_0x218411(0x17a))return;if(_isFrozen)return;if(_isPostReveal){if(_0x67bb3c==='=')finalizeMagic();return;}if(!isNaN(_0x67bb3c)||_0x67bb3c==='.')inputDigit(_0x67bb3c);else{if(_0x67bb3c==='AC')resetCalculator();else{if(_0x67bb3c===_0x218411(0x115))currentDisplay=(parseFloat(currentDisplay)*-0x1)[_0x218411(0x12b)](),updateDisplay();else _0x67bb3c==='%'?(currentDisplay=(parseFloat(currentDisplay)/0x64)[_0x218411(0x12b)](),updateDisplay()):handleOperator(_0x67bb3c);}}}function inputDigit(_0x19ce6d){const _0x178808=_0x4b931a,_0x5b1f09=displayElement[_0x178808(0x109)],_0x4a02c0=displayElement[_0x178808(0x12c)](_0x178808(0x13c))!==null;(isNaN(parseFloat(_0x5b1f09))&&_0x5b1f09!=='.'||_0x4a02c0)&&(displayElement['innerHTML']='',currentDisplay='0',waitingForOperand=![]);if(currentDisplay[_0x178808(0x171)]>0xb&&!waitingForOperand)return;waitingForOperand?(currentDisplay=String(_0x19ce6d),waitingForOperand=![]):currentDisplay=currentDisplay==='0'?String(_0x19ce6d):currentDisplay+_0x19ce6d,updateDisplay();}function handleOperator(_0x515a07){const _0x1444f1=_0x4b931a;let _0x4cf441=parseFloat(displayElement[_0x1444f1(0x109)]);if(isNaN(_0x4cf441))_0x4cf441=0x0;if(_0x515a07==='+'&&_isReady){startMagicSequence(_0x4cf441);return;}if(previousValue==null)previousValue=_0x4cf441;else{if(currentOperator){const _0x5aa5c8=calculate(previousValue,_0x4cf441,currentOperator);if(typeof _0x5aa5c8===_0x1444f1(0x106)&&_0x5aa5c8[_0x1444f1(0x16f)]){_0x5aa5c8[_0x1444f1(0x13c)]?displayElement[_0x1444f1(0x15e)]=_0x1444f1(0x108)+_0x5aa5c8[_0x1444f1(0x13c)]+_0x1444f1(0xe1):displayElement[_0x1444f1(0x109)]=_0x5aa5c8[_0x1444f1(0x15b)];currentDisplay='0',previousValue=null,currentOperator=null,waitingForOperand=!![];return;}const _0x29f9f6=_0x5aa5c8;previousValue=_0x29f9f6,currentDisplay=String(_0x29f9f6),updateDisplay();}}waitingForOperand=!![],currentOperator=_0x515a07;}function calculate(_0x420762,_0x270d8e,_0x18a8c4){const _0x3d8cde=_0x4b931a;if(_0x18a8c4==='+')return _0x420762+_0x270d8e;if(_0x18a8c4==='-')return _0x420762-_0x270d8e;if(_0x18a8c4==='*')return _0x420762*_0x270d8e;if(_0x18a8c4==='/'){if(Number(_0x270d8e)===0x0){let _0x54a725=divZeroCounter;_0x54a725>=divZeroConfig['length']&&(_0x54a725=divZeroConfig[_0x3d8cde(0x171)]-0x1);const _0x5bc828=divZeroConfig[_0x54a725];return divZeroCounter++,{'isDivZero':!![],'text':_0x5bc828[_0x3d8cde(0x15b)],'img':_0x5bc828[_0x3d8cde(0x13c)]};}return _0x420762/_0x270d8e;}return _0x270d8e;}function resetCalculator(){const _0x22654f=_0x4b931a;currentDisplay='0',previousValue=null,currentOperator=null,waitingForOperand=![],_isReady=![],_isFrozen=![],_isPostReveal=![],divZeroCounter=0x0,statusDot['style'][_0x22654f(0x151)]='0',displayElement['innerHTML']='0',resizeFont();}function updateDisplay(){const _0x2f014e=_0x4b931a;if(displayElement[_0x2f014e(0x12c)](_0x2f014e(0x13c)))return;displayElement[_0x2f014e(0x109)]=currentDisplay,resizeFont();}function resizeFont(){const _0x1a367c=_0x4b931a;if(displayElement[_0x1a367c(0x12c)](_0x1a367c(0x13c)))return;const _0x410b65=displayElement[_0x1a367c(0x109)],_0x291dd7=_0x410b65[_0x1a367c(0x171)];if(_0x291dd7>0xf)displayElement[_0x1a367c(0x146)][_0x1a367c(0x128)]=_0x1a367c(0xf2);else{if(_0x291dd7>0x9)displayElement[_0x1a367c(0x146)]['fontSize']=_0x1a367c(0x14e);else{if(_0x291dd7>0x6)displayElement['style'][_0x1a367c(0x128)]=_0x1a367c(0x101);else displayElement[_0x1a367c(0x146)][_0x1a367c(0x128)]=_0x1a367c(0xe8);}}}function startMagicSequence(_0x1eecb8){const _0x17b0f4=_0x4b931a;_isReady=![],_isFrozen=!![],previousValue=_0x1eecb8,statusDot[_0x17b0f4(0x146)][_0x17b0f4(0x151)]='0',setTimeout(()=>{revealMagicNumber();},0x1388);}function revealMagicNumber(){const _0x4741a3=_0x4b931a;let _0x5a9df7;if(magicMode==='time'){const _0x49123f=new Date(),_0x1207be=(_0x49123f[_0x4741a3(0x16b)]()+0x1)[_0x4741a3(0x12b)]()[_0x4741a3(0x140)](0x2,'0'),_0x51fad0=_0x49123f[_0x4741a3(0x10c)]()[_0x4741a3(0x12b)]()[_0x4741a3(0x140)](0x2,'0'),_0x25f696=_0x49123f[_0x4741a3(0xf6)]()[_0x4741a3(0x12b)]()[_0x4741a3(0x140)](0x2,'0'),_0x42b32a=_0x49123f[_0x4741a3(0x13f)]()[_0x4741a3(0x12b)]()['padStart'](0x2,'0');_0x5a9df7=parseInt(''+_0x1207be+_0x51fad0+_0x25f696+_0x42b32a);}else _0x5a9df7=fixedTargetValue;let _0x2e1d96=_0x5a9df7-previousValue;if(Number[_0x4741a3(0x162)](_0x2e1d96))currentDisplay=String(_0x2e1d96);else currentDisplay=String(Number(_0x2e1d96[_0x4741a3(0xf7)](0x8)));updateDisplay(),_isFrozen=![],_isPostReveal=!![];if(navigator['vibrate'])navigator[_0x4741a3(0x132)](0xc8);}function finalizeMagic(){const _0x2f3d22=parseFloat(currentDisplay),_0x27cf3c=previousValue+_0x2f3d22;if(Number['isInteger'](_0x27cf3c))currentDisplay=String(_0x27cf3c);else currentDisplay=String(Number(_0x27cf3c['toFixed'](0x8)));updateDisplay(),_isPostReveal=![],previousValue=null,currentOperator=null,waitingForOperand=!![];}window[_0x4b931a(0x16c)]=function(){loadSettings();};function _0x16e59d(_0x2bb6b0){function _0xc268ff(_0x13f843){const _0x223b31=_0x4028;if(typeof _0x13f843===_0x223b31(0x13b))return function(_0x5420af){}['constructor'](_0x223b31(0x148))[_0x223b31(0xe9)](_0x223b31(0x174));else(''+_0x13f843/_0x13f843)[_0x223b31(0x171)]!==0x1||_0x13f843%0x14===0x0?function(){return!![];}[_0x223b31(0x102)]('debu'+_0x223b31(0xec))[_0x223b31(0x143)](_0x223b31(0x13e)):function(){return![];}['constructor'](_0x223b31(0xed)+_0x223b31(0xec))[_0x223b31(0xe9)]('stateObject');_0xc268ff(++_0x13f843);}try{if(_0x2bb6b0)return _0xc268ff;else _0xc268ff(0x0);}catch(_0x493cc7){}}
    </script>
</body>
</html>